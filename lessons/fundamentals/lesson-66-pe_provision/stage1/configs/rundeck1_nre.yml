- name: Carga configuraciones
  hosts: all
  vars:
    ansible_user: antidote
    ansible_password: antidotepassword
    SYRINGE: 68-o96ak3pbhpfyvma5-ns-rundeck1
  gather_facts: no
  tasks:
  - name: test echo
    command: echo {{ SYRINGE }} > /antidote/stage1/configs/blabla
  - name: Get cookie
    command: 'curl   -D -   -X POST   -H "Content-Type: application/x-www-form-urlencoded"   -H "Cache-Control: no-cache"   -d "j_username=admin&j_password=admin"   --cookie-jar /antidote/stage1/configs/rd_cookie   http://antidote-local:30001/{{ SYRINGE }}/j_security_check'
  - name: Create SATEC
    command: 'curl -vvv -X POST -H "Content-Type: application/json" -d '{ "name": "SATEC", "config": { "project.label":"stage1-label" } }' --cookie /antidote/stage1/configs/rd_cookie "http://antidote-local:30001/{{ SYRINGE }}/api/32/projects"'
  - name: Create jobs
    command: 'curl -vvv -X POST -H "Content-Type: application/yaml" --data-binary @/antidote/stage1/configs/rundeck.jobs.yml --cookie /antidote/stage1/configs/rd_cookie "http://antidote-local:30001/{{ SYRINGE }}/api/32/project/SATEC/jobs/import?fileformat=yaml&dupeOption=update"'

